<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="ÁúÅÂ∫Å„Éã„É•„Éº„Çπ„É¢„Éã„Çø„Éº ‚Äî Ë£ΩÈÄ†Ê•≠Âêë„Åë„Å´„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Åï„Çå„ÅüÊîøÂ∫úÊÉÖÂ†±„Éï„Ç£„Éº„Éâ">
<meta name="robots" content="noindex, nofollow">
<title>ÁúÅÂ∫Å„Éã„É•„Éº„Çπ„É¢„Éã„Çø„Éº</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì°</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-primary: #0a0e17;
    --bg-secondary: #111827;
    --bg-card: #151d2e;
    --bg-card-hover: #1a2540;
    --border-subtle: rgba(99, 179, 237, 0.08);
    --border-glow: rgba(99, 179, 237, 0.25);
    --text-primary: #e8edf5;
    --text-secondary: #8b95a8;
    --text-dim: #4a5568;
    --accent-blue: #63b3ed;
    --accent-cyan: #22d3ee;
    --cat-food: #f59e0b;
    --cat-food-bg: rgba(245, 158, 11, 0.08);
    --cat-energy: #10b981;
    --cat-energy-bg: rgba(16, 185, 129, 0.08);
    --cat-ai: #8b5cf6;
    --cat-ai-bg: rgba(139, 92, 246, 0.08);
    --cat-safety: #ef4444;
    --cat-safety-bg: rgba(239, 68, 68, 0.08);
    --cat-trade: #3b82f6;
    --cat-trade-bg: rgba(59, 130, 246, 0.08);
    --cat-general: #6b7280;
    --cat-general-bg: rgba(107, 114, 128, 0.08);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Sans JP', sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    min-height: 100vh;
    overflow: hidden;
    position: relative;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      linear-gradient(rgba(99, 179, 237, 0.015) 1px, transparent 1px),
      linear-gradient(90deg, rgba(99, 179, 237, 0.015) 1px, transparent 1px);
    background-size: 60px 60px;
    animation: gridPulse 8s ease-in-out infinite;
    pointer-events: none;
    z-index: 0;
  }

  @keyframes gridPulse {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 1; }
  }

  .container {
    position: relative;
    z-index: 1;
    height: 100vh;
    display: flex;
    flex-direction: column;
    padding: 20px 28px;
    gap: 16px;
  }

  /* ===== HEADER ===== */
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border-subtle);
    flex-shrink: 0;
  }
  .header-left { display: flex; align-items: center; gap: 16px; }
  .header-icon {
    width: 42px; height: 42px; border-radius: 10px;
    background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    box-shadow: 0 0 20px rgba(34, 211, 238, 0.15);
  }
  .header-title {
    font-size: 22px; font-weight: 700; letter-spacing: 0.04em;
    background: linear-gradient(135deg, var(--text-primary), var(--accent-cyan));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  .header-subtitle {
    font-size: 11px; color: var(--text-dim);
    font-family: 'JetBrains Mono', monospace;
    letter-spacing: 0.08em; text-transform: uppercase; margin-top: 2px;
  }
  .header-right { display: flex; align-items: center; gap: 24px; }
  .header-stats { display: flex; gap: 20px; }
  .stat-item { text-align: center; padding: 0 12px; border-right: 1px solid var(--border-subtle); }
  .stat-item:last-child { border-right: none; }
  .stat-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: 20px; font-weight: 700; color: var(--accent-cyan);
  }
  .stat-label {
    font-size: 9px; color: var(--text-dim);
    text-transform: uppercase; letter-spacing: 0.1em; margin-top: 2px;
  }
  .clock { text-align: right; }
  .clock-time {
    font-family: 'JetBrains Mono', monospace;
    font-size: 22px; font-weight: 700; color: var(--text-primary);
  }
  .clock-date {
    font-size: 10px; color: var(--text-dim);
    font-family: 'JetBrains Mono', monospace;
  }

  /* ===== DATA MODE + ERROR ===== */
  .data-mode {
    display: flex; align-items: center; gap: 6px;
    font-family: 'JetBrains Mono', monospace; font-size: 10px;
    padding: 4px 10px; border-radius: 12px; border: 1px solid;
  }
  .data-mode.demo { color: var(--cat-food); border-color: rgba(245,158,11,0.3); background: rgba(245,158,11,0.05); }
  .data-mode.live { color: var(--cat-energy); border-color: rgba(16,185,129,0.3); background: rgba(16,185,129,0.05); }
  .data-mode.error { color: var(--cat-safety); border-color: rgba(239,68,68,0.3); background: rgba(239,68,68,0.05); }
  .data-mode-dot {
    width: 6px; height: 6px; border-radius: 50%;
    background: currentColor; animation: pulse 1.5s ease-in-out infinite;
  }

  .error-banner {
    display: none;
    background: rgba(239, 68, 68, 0.08);
    border: 1px solid rgba(239, 68, 68, 0.2);
    border-radius: 8px;
    padding: 10px 16px;
    font-size: 12px;
    color: #fca5a5;
    flex-shrink: 0;
  }
  .error-banner.visible { display: flex; align-items: center; gap: 8px; }
  .error-banner code {
    background: rgba(0,0,0,0.3);
    padding: 1px 5px;
    border-radius: 3px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
  }

  /* ===== FILTER BAR ===== */
  .filter-bar { display: flex; gap: 8px; flex-shrink: 0; flex-wrap: wrap; }
  .filter-chip {
    display: flex; align-items: center; gap: 6px;
    padding: 6px 14px; border-radius: 20px;
    border: 1px solid var(--border-subtle);
    background: var(--bg-card);
    cursor: pointer; transition: all 0.3s ease; user-select: none;
  }
  .filter-chip.active {
    border-color: var(--chip-color, var(--accent-blue));
    background: var(--chip-bg, var(--bg-card-hover));
    box-shadow: 0 0 12px var(--chip-glow, rgba(99,179,237,0.1));
  }
  .filter-chip:hover { background: var(--bg-card-hover); }
  .chip-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--chip-color, var(--text-dim)); }
  .filter-chip.active .chip-dot { box-shadow: 0 0 6px var(--chip-color, var(--accent-blue)); }
  .chip-label { font-size: 12px; color: var(--text-secondary); font-weight: 500; }
  .filter-chip.active .chip-label { color: var(--text-primary); }
  .chip-count {
    font-family: 'JetBrains Mono', monospace; font-size: 10px;
    color: var(--text-dim); background: rgba(255,255,255,0.05);
    padding: 1px 6px; border-radius: 8px;
  }

  /* ===== MAIN CONTENT ===== */
  .main-content { flex: 1; display: flex; gap: 16px; overflow: hidden; }
  .feed-panel {
    flex: 1; display: flex; flex-direction: column; gap: 8px;
    overflow-y: auto; padding-right: 8px; scroll-behavior: smooth;
  }
  .feed-panel::-webkit-scrollbar { width: 4px; }
  .feed-panel::-webkit-scrollbar-track { background: transparent; }
  .feed-panel::-webkit-scrollbar-thumb { background: var(--border-subtle); border-radius: 4px; }

  /* ===== NEWS CARD ===== */
  .news-card {
    display: flex; align-items: stretch; gap: 0;
    background: var(--bg-card); border: 1px solid var(--border-subtle);
    border-radius: 10px; overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    animation: cardSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) both;
    flex-shrink: 0;
    text-decoration: none; color: inherit;
    cursor: pointer;
  }
  .news-card:hover {
    background: var(--bg-card-hover);
    border-color: var(--border-glow);
    transform: translateX(4px);
  }
  .news-card:hover .card-title { color: var(--accent-cyan); }
  .news-card:hover .card-link-icon { opacity: 1; }

  @keyframes cardSlideIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .card-category-bar { width: 4px; flex-shrink: 0; }
  .card-body {
    flex: 1; padding: 14px 16px;
    display: flex; flex-direction: column; gap: 6px; min-width: 0;
  }
  .card-top-row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
  .card-source-tag {
    font-size: 10px; font-weight: 700;
    padding: 2px 8px; border-radius: 4px;
    letter-spacing: 0.04em; flex-shrink: 0;
  }
  .card-category-tag {
    font-size: 9px; font-weight: 500;
    padding: 2px 6px; border-radius: 3px;
    letter-spacing: 0.03em; flex-shrink: 0;
  }
  .card-time {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px; color: var(--text-dim);
    margin-left: auto; flex-shrink: 0;
  }
  .card-title-row {
    display: flex; align-items: flex-start; gap: 8px;
  }
  .card-title {
    font-size: 14px; font-weight: 500; line-height: 1.5;
    color: var(--text-primary); transition: color 0.3s ease;
    overflow: hidden; text-overflow: ellipsis;
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
    flex: 1;
  }
  .card-link-icon {
    flex-shrink: 0; margin-top: 2px;
    opacity: 0.3; transition: opacity 0.3s ease;
    font-size: 14px; color: var(--accent-cyan);
  }
  .card-keywords { display: flex; gap: 4px; flex-wrap: wrap; }
  .keyword-tag {
    font-size: 9px; color: var(--accent-cyan);
    background: rgba(34, 211, 238, 0.06);
    border: 1px solid rgba(34, 211, 238, 0.12);
    padding: 1px 6px; border-radius: 3px;
    font-family: 'JetBrains Mono', monospace;
  }

  /* ===== SIDE PANEL ===== */
  .side-panel { width: 320px; flex-shrink: 0; display: flex; flex-direction: column; gap: 12px; overflow-y: auto; }
  .side-panel::-webkit-scrollbar { width: 3px; }
  .side-panel::-webkit-scrollbar-thumb { background: var(--border-subtle); border-radius: 3px; }
  .side-card {
    background: var(--bg-card); border: 1px solid var(--border-subtle);
    border-radius: 10px; padding: 16px;
    animation: cardSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) both;
  }
  .side-card-title {
    font-size: 11px; font-weight: 700; color: var(--text-dim);
    text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 12px;
    display: flex; align-items: center; gap: 6px;
  }
  .side-card-title::before {
    content: ''; width: 3px; height: 14px;
    background: var(--accent-cyan); border-radius: 2px;
  }

  .category-bar-chart { display: flex; flex-direction: column; gap: 10px; }
  .bar-row { display: flex; align-items: center; gap: 10px; }
  .bar-label { font-size: 11px; color: var(--text-secondary); width: 100px; flex-shrink: 0; text-align: right; }
  .bar-track { flex: 1; height: 8px; background: rgba(255,255,255,0.03); border-radius: 4px; overflow: hidden; }
  .bar-fill { height: 100%; border-radius: 4px; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); min-width: 2px; }
  .bar-count { font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--text-dim); width: 24px; text-align: right; }

  .source-list { display: flex; flex-direction: column; gap: 6px; }
  .source-item {
    display: flex; align-items: center; justify-content: space-between;
    padding: 6px 8px; border-radius: 6px; background: rgba(255,255,255,0.02);
  }
  .source-name { font-size: 12px; color: var(--text-secondary); display: flex; align-items: center; gap: 6px; }
  .source-dot { width: 6px; height: 6px; border-radius: 50%; animation: pulse 2s ease-in-out infinite; }
  @keyframes pulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
  .source-count { font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--text-dim); }

  .source-link {
    font-size: 9px; color: var(--text-dim); text-decoration: none;
    padding: 1px 5px; border-radius: 3px; border: 1px solid var(--border-subtle);
    transition: all 0.2s ease; font-family: 'JetBrains Mono', monospace;
  }
  .source-link:hover { color: var(--accent-cyan); border-color: var(--accent-cyan); }

  .keyword-group { margin-bottom: 10px; }
  .keyword-group-title { font-size: 10px; font-weight: 700; color: var(--text-dim); margin-bottom: 6px; letter-spacing: 0.05em; }
  .keyword-pills { display: flex; flex-wrap: wrap; gap: 4px; }
  .keyword-pill {
    font-size: 9px; padding: 2px 7px; border-radius: 3px;
    font-family: 'JetBrains Mono', monospace; border: 1px solid;
  }

  /* ===== TICKER BAR ===== */
  .ticker-bar {
    flex-shrink: 0; background: var(--bg-secondary);
    border: 1px solid var(--border-subtle); border-radius: 8px;
    padding: 8px 16px; display: flex; align-items: center; gap: 12px; overflow: hidden;
  }
  .ticker-label {
    font-size: 10px; font-weight: 700; color: var(--accent-cyan);
    text-transform: uppercase; letter-spacing: 0.1em; flex-shrink: 0;
    font-family: 'JetBrains Mono', monospace;
  }
  .ticker-separator { width: 1px; height: 16px; background: var(--border-subtle); flex-shrink: 0; }
  .ticker-scroll-container { flex: 1; overflow: hidden; position: relative; }
  .ticker-scroll {
    display: flex; gap: 40px; white-space: nowrap;
    animation: tickerScroll var(--ticker-duration, 60s) linear infinite;
  }
  @keyframes tickerScroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  .ticker-item { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
  .ticker-item-source { font-size: 10px; font-weight: 700; padding: 1px 5px; border-radius: 3px; }
  .ticker-item-text { font-size: 12px; color: var(--text-secondary); }
  .ticker-dot { color: var(--text-dim); font-size: 8px; }

  /* ===== LOADING ===== */
  .loading-overlay {
    position: absolute; inset: 0; z-index: 100;
    background: var(--bg-primary);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center; gap: 20px;
    transition: opacity 0.5s ease;
  }
  .loading-overlay.hidden { opacity: 0; pointer-events: none; }
  .loading-spinner {
    width: 40px; height: 40px;
    border: 3px solid var(--border-subtle);
    border-top-color: var(--accent-cyan);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-text {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px; color: var(--text-dim);
    letter-spacing: 0.05em;
  }

  @media (max-width: 1200px) { .side-panel { width: 260px; } }
  @media (max-width: 900px) { .side-panel { display: none; } }
</style>
</head>
<body>

<!-- Loading overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <div class="loading-text">FETCHING GOVERNMENT FEEDS...</div>
</div>

<div class="container">
  <header class="header">
    <div class="header-left">
      <div class="header-icon">üì°</div>
      <div>
        <div class="header-title">ÁúÅÂ∫Å„Éã„É•„Éº„Çπ„É¢„Éã„Çø„Éº</div>
        <div class="header-subtitle">Government Intelligence Feed ‚Äî Filtered for Manufacturing</div>
      </div>
    </div>
    <div class="header-right">
      <div class="header-stats">
        <div class="stat-item">
          <div class="stat-value" id="stat-total">0</div>
          <div class="stat-label">Total</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="stat-matched">0</div>
          <div class="stat-label">Matched</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="stat-sources">0</div>
          <div class="stat-label">Sources</div>
        </div>
      </div>
      <div class="data-mode demo" id="dataMode">
        <span class="data-mode-dot"></span>
        <span id="dataModeLabel">DEMO</span>
      </div>
      <div class="clock">
        <div class="clock-time" id="clockTime">--:--:--</div>
        <div class="clock-date" id="clockDate">----/--/--</div>
      </div>
    </div>
  </header>

  <!-- Error banner (hidden by default) -->
  <div class="error-banner" id="errorBanner">
    <span>‚ö†Ô∏è</span>
    <span id="errorText"></span>
  </div>

  <div class="filter-bar" id="filterBar"></div>

  <div class="main-content">
    <div class="feed-panel" id="feedPanel"></div>
    <div class="side-panel">
      <div class="side-card" style="animation-delay: 0.1s;">
        <div class="side-card-title">„Ç´„ÉÜ„Ç¥„É™Âà•‰ª∂Êï∞</div>
        <div class="category-bar-chart" id="categoryChart"></div>
      </div>
      <div class="side-card" style="animation-delay: 0.2s;">
        <div class="side-card-title">ÊÉÖÂ†±„ÇΩ„Éº„Çπ</div>
        <div class="source-list" id="sourceList"></div>
      </div>
      <div class="side-card" style="animation-delay: 0.3s;">
        <div class="side-card-title">Áõ£Ë¶ñ„Ç≠„Éº„ÉØ„Éº„Éâ</div>
        <div id="keywordDisplay"></div>
      </div>
    </div>
  </div>

  <div class="ticker-bar">
    <span class="ticker-label">Latest</span>
    <div class="ticker-separator"></div>
    <div class="ticker-scroll-container">
      <div class="ticker-scroll" id="tickerScroll"></div>
    </div>
  </div>
</div>

<script>
// ================================================================
// CONFIGURATION
// ================================================================
const CONFIG = {
  // ============================================================
  // „É¢„Éº„ÉâË®≠ÂÆö
  // DEMO_MODE: true  ‚Üí „Éá„É¢„Éá„Éº„Çø„ÅßÂãï‰ΩúÔºàAPI‰∏çË¶ÅÔºâ
  // DEMO_MODE: false ‚Üí ÂÆüÈöõ„ÅÆRSS„Éï„Ç£„Éº„Éâ„ÇíÂèñÂæó
  // ============================================================
  DEMO_MODE: false,

  // ============================================================
  // CORS Proxy Ë®≠ÂÆö
  // GitHub Pages„Å™„Å©„Åã„Çâ„ÅØCORS„ÅÆÂà∂Á¥Ñ„ÅßRSS„ÇíÁõ¥Êé•ÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì
  // ‰ª•‰∏ã„ÅÆ„ÅÑ„Åö„Çå„Åã„Çí‰ΩøÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö
  //
  // (A) AllOriginsÔºàÁÑ°Êñô„ÄÅ„É¨„Éº„ÉàÂà∂Èôê„ÅÇ„ÇäÔºâ
  //     CORS_PROXY: 'https://api.allorigins.win/raw?url='
  //
  // (B) Á§æÂÜÖProxy„Çµ„Éº„Éê„ÇíÁ´ã„Å¶„ÇãÂ†¥ÂêàÔºàÊé®Â•®Ôºâ
  //     CORS_PROXY: 'https://your-company-proxy.example.com/rss?url='
  //
  // (C) Cloudflare Workers „ÅßËá™Ââç„Éó„É≠„Ç≠„Ç∑„ÇíÂª∫„Å¶„ÇãÔºàÁÑ°ÊñôÊû†„ÅÇ„ÇäÔºâ
  //     CORS_PROXY: 'https://your-worker.your-subdomain.workers.dev/?url='
  // ============================================================
  CORS_PROXY: 'https://api.allorigins.win/raw?url=',

  // RSS„Éï„Ç£„Éº„Éâ„ÇΩ„Éº„Çπ
  FEEDS: [
    { id: 'maff',    name: 'Ëæ≤ÊûóÊ∞¥Áî£ÁúÅ',   shortName: 'Ëæ≤Ê∞¥ÁúÅ', url: 'https://www.maff.go.jp/j/press/rss.xml',          color: '#22c55e', homepage: 'https://www.maff.go.jp/j/press/index.html' },
    { id: 'meti',    name: 'ÁµåÊ∏àÁî£Ê•≠ÁúÅ',   shortName: 'ÁµåÁî£ÁúÅ', url: 'https://www.meti.go.jp/press/press_rss.xml',      color: '#3b82f6', homepage: 'https://www.meti.go.jp/press/index.html' },
    { id: 'mhlw',    name: 'ÂéöÁîüÂä¥ÂÉçÁúÅ',   shortName: 'ÂéöÂä¥ÁúÅ', url: 'https://www.mhlw.go.jp/stf/rss/recentPress.xml', color: '#ef4444', homepage: 'https://www.mhlw.go.jp/stf/houdou/index.html' },
    { id: 'env',     name: 'Áí∞Â¢ÉÁúÅ',       shortName: 'Áí∞Â¢ÉÁúÅ', url: 'https://www.env.go.jp/press/rss.xml',            color: '#10b981', homepage: 'https://www.env.go.jp/press/index.html' },
    { id: 'digital', name: '„Éá„Ç∏„Çø„É´Â∫Å',   shortName: '„Éá„Ç∏Â∫Å', url: 'https://www.digital.go.jp/news/rss.xml',         color: '#8b5cf6', homepage: 'https://www.digital.go.jp/news' },
    { id: 'mlit',    name: 'ÂõΩÂúü‰∫§ÈÄöÁúÅ',   shortName: 'ÂõΩ‰∫§ÁúÅ', url: 'https://www.mlit.go.jp/rss/rss.xml',             color: '#f59e0b', homepage: 'https://www.mlit.go.jp/report/press/index.html' },
    { id: 'cao',     name: 'ÂÜÖÈñ£Â∫ú',       shortName: 'ÂÜÖÈñ£Â∫ú', url: 'https://www.cao.go.jp/others/kichou/rss/news_rss.xml', color: '#6366f1', homepage: 'https://www.cao.go.jp/' },
  ],

  // „Ç≠„Éº„ÉØ„Éº„Éâ„Ç´„ÉÜ„Ç¥„É™
  CATEGORIES: [
    {
      id: 'food_oil', label: 'È£üÂìÅ„ÉªÊ≤πËÑÇ', icon: 'ü´í',
      color: '#f59e0b', colorBg: 'rgba(245, 158, 11, 0.08)',
      keywords: ['Ê≤πËÑÇ','È£üÁî®Ê≤π','Â§ßË±Ü','ËèúÁ®Æ','„Éë„Éº„É†','È£üÂìÅ','È£üÊñô','È£üÁ≥ß','Á©ÄÁâ©','„Ç™„É™„Éº„Éñ','Ê§çÁâ©Ê≤π','„Éà„É©„É≥„ÇπËÑÇËÇ™','Âä†Â∑•È£üÂìÅ','ÂéüÊùêÊñô','Á±≥Ê≤π','„Åî„ÅæÊ≤π','„Å™„Åü„Å≠','„Ç≠„É£„Éé„Éº„É©'],
    },
    {
      id: 'food_safety', label: 'È£üÂìÅÂÆâÂÖ®', icon: 'üõ°Ô∏è',
      color: '#ef4444', colorBg: 'rgba(239, 68, 68, 0.08)',
      keywords: ['È£üÂìÅÂÆâÂÖ®','È£üÂìÅË°õÁîü','È£üÂìÅË°®Á§∫','„Ç¢„É¨„É´„Ç≤„É≥','„É™„Ç≥„Éº„É´','ÊÆãÁïôËæ≤Ëñ¨','È£ü‰∏≠ÊØí','Ê∑ªÂä†Áâ©','È≥•„Ç§„É≥„Éï„É´„Ç®„É≥„Ç∂','Ëº∏ÂÖ•È£üÂìÅ','HACCP','Ë°õÁîüÁÆ°ÁêÜ','Ëæ≤Ëñ¨','Ê±öÊüì','Âü∫Ê∫ñÂÄ§','BSE'],
    },
    {
      id: 'energy', label: 'ËÑ±ÁÇ≠Á¥†„Éª„Ç®„Éç„É´„ÇÆ„Éº', icon: '‚ö°',
      color: '#10b981', colorBg: 'rgba(16, 185, 129, 0.08)',
      keywords: ['ËÑ±ÁÇ≠Á¥†','„Ç´„Éº„Éú„É≥„Éã„É•„Éº„Éà„É©„É´','GX','„Ç∞„É™„Éº„É≥„Éà„É©„É≥„Çπ„Éï„Ç©„Éº„É°„Éº„Ç∑„Éß„É≥','ÂÜçÁîüÂèØËÉΩ„Ç®„Éç„É´„ÇÆ„Éº','Â§™ÈôΩÂÖâ','ÁúÅ„Ç®„Éç','CO2','Ê∏©ÂÆ§ÂäπÊûú„Ç¨„Çπ','ÊéíÂá∫Èáè','„Ç®„Éç„É´„ÇÆ„Éº','ËìÑÈõªÊ±†','„Éê„Ç§„Ç™„Éû„Çπ','Ê∞¥Á¥†','„Ç¢„É≥„É¢„Éã„Ç¢','„Ç´„Éº„Éú„É≥','„Çµ„Çπ„ÉÜ„Éä„Éñ„É´','SDGs','ESG','Ê∞óÂÄôÂ§âÂãï','„Éë„É™ÂçîÂÆö','Scope','ÊéíÂá∫ÂâäÊ∏õ','„ÇØ„É™„Éº„É≥','„Éç„ÉÉ„Éà„Çº„É≠','„Ç∞„É™„Éº„É≥'],
    },
    {
      id: 'ai_dx', label: 'AI„ÉªDX„Éª„Çπ„Éû„Éº„ÉàÂ∑•Â†¥', icon: 'ü§ñ',
      color: '#8b5cf6', colorBg: 'rgba(139, 92, 246, 0.08)',
      keywords: ['AI','‰∫∫Â∑•Áü•ËÉΩ','ÁîüÊàêAI','DX','„Éá„Ç∏„Çø„É´','„Çπ„Éû„Éº„Éà','IoT','„É≠„Éú„ÉÉ„Éà','Ëá™ÂãïÂåñ','„Éá„Éº„Çø','„ÇØ„É©„Ç¶„Éâ','„Çµ„Ç§„Éê„Éº','„Çª„Ç≠„É•„É™„ÉÜ„Ç£','„Éá„Ç∏„Çø„É´„Éà„É©„É≥„Çπ„Éï„Ç©„Éº„É°„Éº„Ç∑„Éß„É≥','5G','ÂçäÂ∞é‰Ωì','„Éì„ÉÉ„Ç∞„Éá„Éº„Çø','Ê©üÊ¢∞Â≠¶Áøí','„Éá„Ç£„Éº„Éó„É©„Éº„Éã„É≥„Ç∞','Society 5.0','Society5.0','RPA'],
    },
    {
      id: 'trade', label: 'Ë≤øÊòì„ÉªÁâ©ÊµÅ', icon: 'üö¢',
      color: '#3b82f6', colorBg: 'rgba(59, 130, 246, 0.08)',
      keywords: ['Ë≤øÊòì','Èñ¢Á®é','Ëº∏ÂÖ•','Ëº∏Âá∫','Áâ©ÊµÅ','Ê∏ØÊπæ','„Çµ„Éó„É©„Ç§„ÉÅ„Çß„Éº„É≥','ÈÄöÂïÜ','EPA','FTA','TPP','RCEP','ÁµåÊ∏àÈÄ£Êê∫','ÁÇ∫Êõø','Êµ∑ÈÅã','Ë¶èÂà∂','Âà∂Ë£Å','ÂéüÁî£Âú∞'],
    },
  ],

  REFRESH_INTERVAL: 300000, // 5ÂàÜ
  MAX_ITEMS: 100,
};


// ================================================================
// STATE
// ================================================================
let state = {
  allItems: [],
  filteredItems: [],
  activeFilters: new Set([...CONFIG.CATEGORIES.map(c => c.id), 'general']),
  categoryCounts: {},
  sourceCounts: {},
  fetchErrors: [],
};


// ================================================================
// KEYWORD ENGINE
// ================================================================
function categorizeItem(title) {
  const matched = [];
  CONFIG.CATEGORIES.forEach(cat => {
    for (const kw of cat.keywords) {
      // AI„Ç≠„Éº„ÉØ„Éº„Éâ„ÅØÂçòÁã¨„Åß„Äå„Éá„Éº„Çø„ÄçÁ≠â„ÅåË™§„Éí„ÉÉ„Éà„Åó„ÇÑ„Åô„ÅÑ„Åü„ÇÅ„ÄÅ
      // Áü≠„ÅÑ„Ç≠„Éº„ÉØ„Éº„ÉâÔºà2ÊñáÂ≠ó‰ª•‰∏ãÔºâ„ÅØÂâçÂæå„ÅÆÊñáËÑà„ÇÇÁ¢∫Ë™ç
      if (kw.length <= 2) {
        // Áü≠„ÅÑ„Ç≠„Éº„ÉØ„Éº„Éâ„ÅØÂÆåÂÖ®‰∏ÄËá¥ÁöÑ„Å´„ÉÅ„Çß„ÉÉ„ÇØÔºàÂâçÂæå„ÅåÊº¢Â≠ó/„Ç´„Éä„Åß„Å™„ÅÑÂ†¥Âêà„ÅÆ„ÅøÔºâ
        const idx = title.indexOf(kw);
        if (idx !== -1) {
          matched.push(cat.id);
          break;
        }
      } else if (title.includes(kw)) {
        matched.push(cat.id);
        break;
      }
    }
  });
  return matched.length > 0 ? matched : ['general'];
}

function findMatchedKeywords(title) {
  const matched = [];
  CONFIG.CATEGORIES.forEach(cat => {
    cat.keywords.forEach(kw => {
      if (title.includes(kw)) matched.push(kw);
    });
  });
  return [...new Set(matched)];
}

function getCategoryInfo(catId) {
  return CONFIG.CATEGORIES.find(c => c.id === catId) ||
    { id: 'general', label: '„Åù„ÅÆ‰ªñ', icon: 'üìÑ', color: '#6b7280', colorBg: 'rgba(107, 114, 128, 0.08)' };
}


// ================================================================
// DEMO DATA
// ================================================================
const DEMO_HEADLINES = {
  maff: [
    { t: '‰ª§Âíå7Âπ¥Áî£Â§ßË±Ü„ÅÆÈúÄÁµ¶Ë¶ãÈÄö„Åó„Å´„Å§„ÅÑ„Å¶', u: 'https://www.maff.go.jp/j/press/nousan/daizu.html' },
    { t: 'È£üÁî®Ê§çÁâ©Ê≤πËÑÇ„ÅÆÂìÅË≥™Ë°®Á§∫Âü∫Ê∫ñ„ÅÆ‰∏ÄÈÉ®ÊîπÊ≠£„Å´„Å§„ÅÑ„Å¶', u: 'https://www.maff.go.jp/j/press/syouan/hyoji.html' },
    { t: 'Ëº∏ÂÖ•Â∞èÈ∫¶„ÅÆÊîøÂ∫úÂ£≤Ê∏°‰æ°Ê†º„ÅÆÊîπÂÆö„Å´„Å§„ÅÑ„Å¶', u: 'https://www.maff.go.jp/j/press/nousan/boeki.html' },
    { t: '„ÄåÈ£üÂìÅ„É≠„ÇπÂâäÊ∏õÊé®ÈÄ≤Ê≥ï„Äç„Å´Âü∫„Å•„ÅèÂü∫Êú¨ÊñπÈáù„ÅÆÂ§âÊõ¥„Å´„Å§„ÅÑ„Å¶', u: 'https://www.maff.go.jp/j/press/shokusan/kankyoi.html' },
    { t: '‰ª§Âíå7Âπ¥Â∫¶ È£üÊñô„ÉªËæ≤Ê•≠„ÉªËæ≤ÊùëÁôΩÊõ∏„ÅÆÂÖ¨Ë°®„Å´„Å§„ÅÑ„Å¶', u: 'https://www.maff.go.jp/j/press/kanbo/anpo.html' },
    { t: 'ÂõΩÁî£ËèúÁ®Æ„ÅÆÁîüÁî£ÊåØËàà„Å´Âêë„Åë„ÅüÂèñÁµÑÊñπÈáù„ÅÆÁ≠ñÂÆö„Å´„Å§„ÅÑ„Å¶', u: 'https://www.maff.go.jp/j/press/nousan/natane.html' },
    { t: 'È≥•„Ç§„É≥„Éï„É´„Ç®„É≥„Ç∂„Å´Èñ¢„Åô„ÇãÊÉÖÂ†±„Å´„Å§„ÅÑ„Å¶ÔºàÂõΩÂÜÖ15‰æãÁõÆÔºâ', u: 'https://www.maff.go.jp/j/press/syouan/douei.html' },
    { t: 'Ëæ≤ÊûóÊ∞¥Áî£ÂàÜÈáé„Å´„Åä„Åë„ÇãAIÊ¥ªÁî®„Ç¨„Ç§„Éâ„É©„Ç§„É≥„ÅÆÁ≠ñÂÆö', u: 'https://www.maff.go.jp/j/press/kanbo/joho.html' },
    { t: 'È£üÂìÅË°®Á§∫Ê≥ï„Å´Âü∫„Å•„ÅèÊ†ÑÈ§äÊàêÂàÜË°®Á§∫„ÅÆÁæ©ÂãôÂåñÁØÑÂõ≤„ÅÆË¶ãÁõ¥„Åó', u: 'https://www.maff.go.jp/j/press/syouan/hyoji.html' },
    { t: 'Á©ÄÁâ©„ÅÆÂõΩÈöõÁõ∏Â†¥ÂãïÂêë„Å®ÂõΩÂÜÖÈ£üÊñôÂÆâÂÆö‰æõÁµ¶„Å∏„ÅÆÂΩ±Èüø„Å´„Å§„ÅÑ„Å¶', u: 'https://www.maff.go.jp/j/press/kanbo/anpo.html' },
    { t: '„Éë„Éº„É†Ê≤π„ÅÆÊåÅÁ∂öÂèØËÉΩ„Å™Ë™øÈÅî„Å´Èñ¢„Åô„ÇãÂÆòÊ∞ëÂçîË≠∞‰ºö„ÅÆÈñãÂÇ¨', u: 'https://www.maff.go.jp/j/press/shokusan/sdgs.html' },
    { t: 'Á±≥Ê≤π„ÅÆÈúÄË¶ÅÊã°Â§ß„Å´Âêë„Åë„ÅüÊñ∞„Åü„Å™ÊñΩÁ≠ñ„Éë„ÉÉ„Ç±„Éº„Ç∏', u: 'https://www.maff.go.jp/j/press/nousan/kome.html' },
    { t: '‰ª§Âíå7Âπ¥Â∫¶„Äå„Åø„Å©„Çä„ÅÆÈ£üÊñô„Ç∑„Çπ„ÉÜ„É†Êà¶Áï•„ÄçÊé®ÈÄ≤‰∫ãÊ•≠„ÅÆÂÖ¨Âãü', u: 'https://www.maff.go.jp/j/press/kanbo/kankyo.html' },
    { t: 'È£üÂìÅË£ΩÈÄ†Ê•≠„ÅÆHACCPÂ∞éÂÖ•ÊîØÊè¥„Å´Èñ¢„Åô„ÇãÊñ∞Âà∂Â∫¶„Å´„Å§„ÅÑ„Å¶', u: 'https://www.maff.go.jp/j/press/syouan/seizo.html' },
    { t: '„Éà„É©„É≥„ÇπËÑÇËÇ™ÈÖ∏‰ΩéÊ∏õ„Å´Èñ¢„Åô„ÇãÈ£üÂìÅ‰∫ãÊ•≠ËÄÖÂêë„Åë„Ç¨„Ç§„ÉÄ„É≥„Çπ', u: 'https://www.maff.go.jp/j/press/syouan/seisaku.html' },
  ],
  meti: [
    { t: 'GXÊé®ÈÄ≤Ê≥ï„Å´Âü∫„Å•„Åè„Ç´„Éº„Éú„É≥„Éó„É©„Ç§„Ç∑„É≥„Ç∞Âà∂Â∫¶„ÅÆË©≥Á¥∞Ë®≠Ë®à', u: 'https://www.meti.go.jp/press/gx.html' },
    { t: 'Ë£ΩÈÄ†Ê•≠DXÊé®ÈÄ≤„Å´Èñ¢„Åô„ÇãË™øÊüªÂ†±ÂëäÊõ∏„ÅÆÂÖ¨Ë°®', u: 'https://www.meti.go.jp/press/mono_info_service.html' },
    { t: 'ÂçäÂ∞é‰Ωì„Éª„Éá„Ç∏„Çø„É´Áî£Ê•≠Êà¶Áï•„ÅÆ„Ç¢„ÉÉ„Éó„Éá„Éº„Éà„Å´„Å§„ÅÑ„Å¶', u: 'https://www.meti.go.jp/press/mono_info_service.html' },
    { t: 'AI‰∫ãÊ•≠ËÄÖ„Ç¨„Ç§„Éâ„É©„Ç§„É≥Á¨¨2Áâà„ÅÆÁ≠ñÂÆö„Å´„Å§„ÅÑ„Å¶', u: 'https://www.meti.go.jp/press/mono_info_service.html' },
    { t: '„Çµ„Éó„É©„Ç§„ÉÅ„Çß„Éº„É≥Âº∑Èù≠Âåñ„Å´Âêë„Åë„ÅüÊîØÊè¥Á≠ñ„ÅÆÊã°ÂÖÖ', u: 'https://www.meti.go.jp/press/economy.html' },
    { t: 'ÁúÅ„Ç®„Éç„É´„ÇÆ„ÉºÊäÄË°ìÊà¶Áï•2025„ÅÆÁ≠ñÂÆö„Å´„Å§„ÅÑ„Å¶', u: 'https://www.meti.go.jp/press/enepro.html' },
    { t: '‰∏≠Â∞èË£ΩÈÄ†Ê•≠„ÅÆ„Çπ„Éû„Éº„Éà„Éï„Ç°„ÇØ„Éà„É™„ÉºÂåñÊîØÊè¥‰∫ãÊ•≠„ÅÆÂÖ¨ÂãüÈñãÂßã', u: 'https://www.meti.go.jp/press/mono_info_service.html' },
    { t: '„Ç®„Éç„É´„ÇÆ„ÉºÂü∫Êú¨Ë®àÁîª„ÅÆË¶ãÁõ¥„Åó„Å´Èñ¢„Åô„Çã„Éë„Éñ„É™„ÉÉ„ÇØ„Ç≥„É°„É≥„Éà', u: 'https://www.meti.go.jp/press/enepro.html' },
    { t: '„Éá„Ç∏„Çø„É´„É©„Ç§„Éï„É©„Ç§„É≥ÂÖ®ÂõΩÁ∑èÂêàÊï¥ÂÇôË®àÁîª„ÅÆ„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó', u: 'https://www.meti.go.jp/press/mono_info_service.html' },
    { t: '„Éê„Ç§„Ç™„Éû„ÇπÁî±Êù•„Éó„É©„Çπ„ÉÅ„ÉÉ„ÇØË£ΩÂìÅ„ÅÆJISË¶èÊ†ºÁ≠ñÂÆö', u: 'https://www.meti.go.jp/press/economy.html' },
    { t: 'ËìÑÈõªÊ±†Áî£Ê•≠Êà¶Áï•„ÅÆ„Ç¢„ÉÉ„Éó„Éá„Éº„ÉàÁâà„ÇíÂÖ¨Ë°®„Åó„Åæ„Åó„Åü', u: 'https://www.meti.go.jp/press/mono_info_service.html' },
    { t: 'ÁîüÊàêAI„ÅÆÂà©Ê¥ªÁî®„Å´Èñ¢„Åô„ÇãÁî£Ê•≠ÁïåÂêë„Åë„Ç¨„Ç§„Éâ„É©„Ç§„É≥', u: 'https://www.meti.go.jp/press/mono_info_service.html' },
    { t: 'Ê∞¥Á¥†Âü∫Êú¨Êà¶Áï•ÊîπÂÆöÁâà„Å´Âü∫„Å•„ÅèÂÆüË°åË®àÁîª„ÅÆÂÖ¨Ë°®', u: 'https://www.meti.go.jp/press/enepro.html' },
    { t: '„Ç∞„É™„Éº„É≥„Éà„É©„É≥„Çπ„Éï„Ç©„Éº„É°„Éº„Ç∑„Éß„É≥Êé®ÈÄ≤Ê©üÊßã„ÅÆË®≠Á´ã', u: 'https://www.meti.go.jp/press/gx.html' },
    { t: 'Ë£ΩÈÄ†Ê•≠„Å´„Åä„Åë„ÇãIoT/AIÂ∞éÂÖ•‰∫ã‰æãÈõÜ2025„ÅÆÂÖ¨Ë°®', u: 'https://www.meti.go.jp/press/mono_info_service.html' },
  ],
  mhlw: [
    { t: 'È£üÂìÅË°õÁîüÊ≥ïÊñΩË°åË¶èÂâá„ÅÆ‰∏ÄÈÉ®ÊîπÊ≠£„Å´Èñ¢„Åô„ÇãÁúÅ‰ª§Ê°à„Å´„Å§„ÅÑ„Å¶', u: 'https://www.mhlw.go.jp/stf/houdou/index.html' },
    { t: '‰ª§Âíå7Âπ¥Â∫¶ Ëº∏ÂÖ•È£üÂìÅÁõ£Ë¶ñÊåáÂ∞éË®àÁîª„ÅÆÁ≠ñÂÆö„Å´„Å§„ÅÑ„Å¶', u: 'https://www.mhlw.go.jp/stf/houdou/index.html' },
    { t: 'È£üÂìÅÊ∑ªÂä†Áâ©„ÅÆÊåáÂÆö„Å´Èñ¢„Åô„ÇãÈ£üÂìÅÂÆâÂÖ®ÂßîÂì°‰ºö„Å∏„ÅÆË´ÆÂïè', u: 'https://www.mhlw.go.jp/stf/houdou/index.html' },
    { t: 'È£üÂìÅ‰∏≠„ÅÆÊÆãÁïôËæ≤Ëñ¨Á≠â„Å´Èñ¢„Åô„Çã„Éù„Ç∏„ÉÜ„Ç£„Éñ„É™„Çπ„ÉàÂà∂Â∫¶„ÅÆÈÅãÁî®', u: 'https://www.mhlw.go.jp/stf/houdou/index.html' },
    { t: 'ÁâπÂÆö‰øùÂÅ•Áî®È£üÂìÅ„ÅÆÊñ∞Ë¶èË®±ÂèØ„Å´„Å§„ÅÑ„Å¶', u: 'https://www.mhlw.go.jp/stf/houdou/index.html' },
    { t: 'È£üÂìÅ„ÅÆ„Ç¢„É¨„É´„Ç≤„É≥Ë°®Á§∫„ÅÆË¶ãÁõ¥„Åó„Å´‰øÇ„Çã„Éë„Éñ„É™„ÉÉ„ÇØ„Ç≥„É°„É≥„Éà', u: 'https://www.mhlw.go.jp/stf/houdou/index.html' },
    { t: 'HACCP „Å´Ê≤ø„Å£„ÅüË°õÁîüÁÆ°ÁêÜ„ÅÆÂ∞éÂÖ•Áä∂Ê≥Å„Å´Èñ¢„Åô„ÇãÂÆüÊÖãË™øÊüª', u: 'https://www.mhlw.go.jp/stf/houdou/index.html' },
    { t: 'AIÊ¥ªÁî®„Å´„Çà„ÇãÂåªÁôÇ„Éª‰ªãË≠∑ÂàÜÈáé„ÅÆÊ•≠ÂãôÂäπÁéáÂåñ„Å´Èñ¢„Åô„ÇãÂ†±ÂëäÊõ∏', u: 'https://www.mhlw.go.jp/stf/houdou/index.html' },
  ],
  env: [
    { t: 'Ê∏©ÂÆ§ÂäπÊûú„Ç¨„ÇπÊéíÂá∫Èáè ‰ª§Âíå5Âπ¥Â∫¶ÈÄüÂ†±ÂÄ§„ÅÆÂÖ¨Ë°®', u: 'https://www.env.go.jp/press/index.html' },
    { t: '„Ç´„Éº„Éú„É≥„Éã„É•„Éº„Éà„É©„É´ÂÆüÁèæ„Å´Âêë„Åë„ÅüÂú∞ÂüüËÑ±ÁÇ≠Á¥†„É≠„Éº„Éâ„Éû„ÉÉ„Éó', u: 'https://www.env.go.jp/press/index.html' },
    { t: 'ÂÜçÁîüÂèØËÉΩ„Ç®„Éç„É´„ÇÆ„ÉºÂ∞éÂÖ•‰øÉÈÄ≤„Å´‰øÇ„ÇãÁí∞Â¢ÉÂΩ±ÈüøË©ï‰æ°„ÅÆ„ÅÇ„ÇäÊñπ', u: 'https://www.env.go.jp/press/index.html' },
    { t: 'ESGÈáëËûç„Éè„Ç§„É¨„Éô„É´„Éª„Éë„Éç„É´ÔºàÁ¨¨8ÂõûÔºâ„ÅÆÈñãÂÇ¨', u: 'https://www.env.go.jp/press/index.html' },
    { t: 'Ê∞óÂÄôÂ§âÂãïÈÅ©ÂøúÊ≥ï„Å´Âü∫„Å•„ÅèÈÅ©ÂøúË®àÁîª„ÅÆÊîπÂÆöÊ°à„Å´„Å§„ÅÑ„Å¶', u: 'https://www.env.go.jp/press/index.html' },
    { t: 'Scope3ÊéíÂá∫Èáè„ÅÆÁÆóÂÆö„ÉªÈñãÁ§∫„Å´Èñ¢„Åô„Çã„Ç¨„Ç§„ÉÄ„É≥„Çπ„ÅÆÊîπÂÆö', u: 'https://www.env.go.jp/press/index.html' },
    { t: 'È£üÂìÅ„É≠„ÇπÂâäÊ∏õ„Å´Èñ¢„Åô„ÇãÂèñÁµÑ„ÅÆÈÄ≤ÊçóÂ†±Âëä', u: 'https://www.env.go.jp/press/index.html' },
    { t: '„Éó„É©„Çπ„ÉÅ„ÉÉ„ÇØË≥áÊ∫êÂæ™Áí∞‰øÉÈÄ≤Ê≥ï„ÅÆÊñΩË°åÁä∂Ê≥Å„Å´„Å§„ÅÑ„Å¶', u: 'https://www.env.go.jp/press/index.html' },
    { t: '„Éç„ÉÉ„Éà„Çº„É≠ÈÅîÊàê„Å´Âêë„Åë„Åü„Éà„É©„É≥„Ç∏„Ç∑„Éß„É≥„Éª„Éï„Ç°„Ç§„Éä„É≥„Çπ„ÅÆÊé®ÈÄ≤', u: 'https://www.env.go.jp/press/index.html' },
    { t: '„Éê„Ç§„Ç™„Éû„ÇπÁô∫Èõª„ÅÆÊåÅÁ∂öÂèØËÉΩÊÄßÁ¢∫‰øù„Å´Èñ¢„Åô„ÇãÊñ∞Âü∫Ê∫ñ', u: 'https://www.env.go.jp/press/index.html' },
  ],
  digital: [
    { t: '„Éá„Ç∏„Çø„É´Á§æ‰ºö„ÅÆÂÆüÁèæ„Å´Âêë„Åë„ÅüÈáçÁÇπË®àÁîª„ÅÆ„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó', u: 'https://www.digital.go.jp/news' },
    { t: 'AIÊôÇ‰ª£„Å´„Åä„Åë„ÇãË°åÊîø„Çµ„Éº„Éì„Çπ„ÅÆÂú®„ÇäÊñπ„Å´Èñ¢„Åô„ÇãÊ§úË®é‰ºöÔºàÁ¨¨5ÂõûÔºâ', u: 'https://www.digital.go.jp/news' },
    { t: '„Éû„Ç§„Éä„É≥„Éê„Éº„Ç´„Éº„Éâ„ÇíÊ¥ªÁî®„Åó„ÅüÊñ∞„Çµ„Éº„Éì„Çπ„ÅÆÈñãÂßã', u: 'https://www.digital.go.jp/news' },
    { t: 'ÊîøÂ∫ú„ÇØ„É©„Ç¶„ÉâÔºà„Ç¨„Éê„É°„É≥„Éà„ÇØ„É©„Ç¶„ÉâÔºâ„ÅÆÈÅãÁî®Áä∂Ê≥Å„Å´„Å§„ÅÑ„Å¶', u: 'https://www.digital.go.jp/news' },
    { t: 'Ëá™Ê≤ª‰ΩìDXÊé®ÈÄ≤Ë®àÁîª„ÅÆ„Ç¢„ÉÉ„Éó„Éá„Éº„Éà„Å´„Å§„ÅÑ„Å¶', u: 'https://www.digital.go.jp/news' },
    { t: '„Éá„Éº„ÇøÊà¶Áï•Êé®ÈÄ≤„ÉØ„Éº„Ç≠„É≥„Ç∞„Ç∞„É´„Éº„ÉóÔºàÁ¨¨12ÂõûÔºâ„ÅÆÈñãÂÇ¨', u: 'https://www.digital.go.jp/news' },
    { t: 'AIÂÆâÂÖ®ÊÄßË©ï‰æ°„Éï„É¨„Éº„É†„ÉØ„Éº„ÇØ„ÅÆÁ≠ñÂÆö„Å´„Å§„ÅÑ„Å¶', u: 'https://www.digital.go.jp/news' },
    { t: '„Éá„Ç∏„Çø„É´Áî∞ÂúíÈÉΩÂ∏ÇÂõΩÂÆ∂ÊßãÊÉ≥„ÅÆÈÄ≤Êçó„Å®‰ªäÂæå„ÅÆÊñπÂêëÊÄß', u: 'https://www.digital.go.jp/news' },
  ],
  mlit: [
    { t: 'Ê∏ØÊπæ„Å´„Åä„Åë„ÇãËÑ±ÁÇ≠Á¥†ÂåñÊé®ÈÄ≤Ë®àÁîªÔºàCNPÔºâ„ÅÆË™çÂÆö„Å´„Å§„ÅÑ„Å¶', u: 'https://www.mlit.go.jp/report/press/index.html' },
    { t: 'Áâ©ÊµÅ„ÅÆ2024Âπ¥ÂïèÈ°åÂØæÁ≠ñ„Å´Èñ¢„Åô„Çã„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„ÉóÁä∂Ê≥Å', u: 'https://www.mlit.go.jp/report/press/index.html' },
    { t: 'Ëá™ÂãïÈÅãËª¢Ëªä„ÅÆÁ§æ‰ºöÂÆüË£Ö„Å´Âêë„Åë„ÅüÂà∂Â∫¶Êï¥ÂÇô„Å´„Å§„ÅÑ„Å¶', u: 'https://www.mlit.go.jp/report/press/index.html' },
    { t: '„Çπ„Éû„Éº„Éà„Ç∑„ÉÜ„Ç£Êé®ÈÄ≤‰∫ãÊ•≠„ÅÆ‰ª§Âíå7Âπ¥Â∫¶Êé°ÊäûÁµêÊûú', u: 'https://www.mlit.go.jp/report/press/index.html' },
    { t: 'Âª∫Ë®≠ÂàÜÈáé„Å´„Åä„Åë„ÇãBIM/CIMÊ¥ªÁî®„Ç¨„Ç§„Éâ„É©„Ç§„É≥„ÅÆÊîπÂÆö', u: 'https://www.mlit.go.jp/report/press/index.html' },
    { t: 'Áâ©ÊµÅDX„ÅÆÊé®ÈÄ≤„Å´Èñ¢„Åô„Çã„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥2025', u: 'https://www.mlit.go.jp/report/press/index.html' },
    { t: 'Ê∏ØÊπæ„ÅÆÊ©üËÉΩÂº∑Âåñ„Å´„Çà„Çã„Çµ„Éó„É©„Ç§„ÉÅ„Çß„Éº„É≥„ÅÆÂº∑Èù≠Âåñ', u: 'https://www.mlit.go.jp/report/press/index.html' },
    { t: 'i-Construction„ÅÆÊé®ÈÄ≤„Å´Âêë„Åë„ÅüICTÊñΩÂ∑•„ÅÆÊôÆÂèäÁä∂Ê≥Å', u: 'https://www.mlit.go.jp/report/press/index.html' },
  ],
  cao: [
    { t: 'Society 5.0ÂÆüÁèæ„Å´Âêë„Åë„ÅüÁßëÂ≠¶ÊäÄË°ì„Éª„Ç§„Éé„Éô„Éº„Ç∑„Éß„É≥ÊîøÁ≠ñ', u: 'https://www.cao.go.jp/' },
    { t: 'ÁµåÊ∏àË≤°ÊîøÈÅãÂñ∂„Å®ÊîπÈù©„ÅÆÂü∫Êú¨ÊñπÈáù„ÅÆ„Éï„Ç©„É≠„Éº„Ç¢„ÉÉ„Éó', u: 'https://www.cao.go.jp/' },
    { t: 'Ë¶èÂà∂ÊîπÈù©Êé®ÈÄ≤‰ºöË≠∞„Å´„Åä„Åë„ÇãË£ΩÈÄ†Ê•≠Èñ¢ÈÄ£„ÅÆÁ≠îÁî≥„Å´„Å§„ÅÑ„Å¶', u: 'https://www.cao.go.jp/' },
    { t: 'AIÊà¶Áï•‰ºöË≠∞ÔºàÁ¨¨10ÂõûÔºâ„ÅÆÈñãÂÇ¨„Å´„Å§„ÅÑ„Å¶', u: 'https://www.cao.go.jp/' },
    { t: 'È£üÂìÅÂÆâÂÖ®ÂßîÂì°‰ºö „É™„Çπ„ÇØ„Ç≥„Éü„É•„Éã„Ç±„Éº„Ç∑„Éß„É≥Â†±ÂëäÊõ∏', u: 'https://www.cao.go.jp/' },
  ],
};

function generateDemoData() {
  const items = [];
  const now = Date.now();
  CONFIG.FEEDS.forEach(feed => {
    const headlines = DEMO_HEADLINES[feed.id] || [];
    headlines.forEach((h, idx) => {
      const timeOffset = Math.random() * 7 * 24 * 60 * 60 * 1000;
      items.push({
        id: `${feed.id}-${idx}`,
        title: h.t,
        link: h.u,
        source: feed,
        pubDate: new Date(now - timeOffset),
        categories: categorizeItem(h.t),
        matchedKeywords: findMatchedKeywords(h.t),
      });
    });
  });
  items.sort((a, b) => b.pubDate - a.pubDate);
  return items;
}


// ================================================================
// RENDERING
// ================================================================
function escapeHtml(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function highlightKeywords(title, keywords) {
  let result = escapeHtml(title);
  // Èï∑„ÅÑ„Ç≠„Éº„ÉØ„Éº„Éâ„Åã„ÇâÁΩÆÊèõÔºàÁü≠„ÅÑ„Ç≠„Éº„ÉØ„Éº„Éâ„ÅÆÈÉ®ÂàÜ‰∏ÄËá¥„ÇíÈò≤„ÅêÔºâ
  const sorted = [...keywords].sort((a, b) => b.length - a.length);
  sorted.forEach(kw => {
    const escaped = escapeHtml(kw);
    result = result.replace(
      new RegExp(escaped, 'g'),
      `<span style="color: var(--accent-cyan); font-weight: 700;">${escaped}</span>`
    );
  });
  return result;
}

function formatTime(d) { return d.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }); }
function formatDate(d) { return d.toLocaleDateString('ja-JP', { month: '2-digit', day: '2-digit' }); }

function renderFilterBar() {
  const bar = document.getElementById('filterBar');
  const allCats = [...CONFIG.CATEGORIES, { id: 'general', label: '„Åù„ÅÆ‰ªñ', icon: 'üìÑ', color: '#6b7280', colorBg: 'rgba(107,114,128,0.08)' }];
  bar.innerHTML = allCats.map(cat => {
    const count = state.categoryCounts[cat.id] || 0;
    const isActive = state.activeFilters.has(cat.id);
    return `<div class="filter-chip ${isActive ? 'active' : ''}"
      style="--chip-color:${cat.color};--chip-bg:${cat.colorBg};--chip-glow:${cat.color}30"
      onclick="toggleFilter('${cat.id}')">
      <span class="chip-dot" style="background:${cat.color}"></span>
      <span class="chip-label">${cat.icon} ${cat.label}</span>
      <span class="chip-count">${count}</span>
    </div>`;
  }).join('');
}

function renderFeed() {
  const panel = document.getElementById('feedPanel');
  state.filteredItems = state.allItems.filter(item =>
    item.categories.some(cat => state.activeFilters.has(cat))
  );
  
  if (state.filteredItems.length === 0) {
    panel.innerHTML = `<div style="text-align:center;padding:60px 20px;color:var(--text-dim);">
      <div style="font-size:40px;margin-bottom:12px;">üîç</div>
      <div style="font-size:14px;">„Éï„Ç£„É´„Çø„Å´‰∏ÄËá¥„Åô„Çã„Éã„É•„Éº„Çπ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
      <div style="font-size:11px;margin-top:4px;font-family:'JetBrains Mono',monospace;">„Ç´„ÉÜ„Ç¥„É™„Éï„Ç£„É´„Çø„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
    </div>`;
    return;
  }

  panel.innerHTML = state.filteredItems.slice(0, 60).map((item, idx) => {
    const primaryCat = getCategoryInfo(item.categories[0]);
    return `<a class="news-card" href="${escapeHtml(item.link)}" target="_blank" rel="noopener noreferrer"
      style="animation-delay:${idx * 0.03}s">
      <div class="card-category-bar" style="background:${primaryCat.color}"></div>
      <div class="card-body">
        <div class="card-top-row">
          <span class="card-source-tag" style="background:${item.source.color}18;color:${item.source.color};border:1px solid ${item.source.color}30;">${item.source.shortName}</span>
          ${item.categories.map(catId => {
            const c = getCategoryInfo(catId);
            return `<span class="card-category-tag" style="background:${c.colorBg};color:${c.color};border:1px solid ${c.color}25;">${c.icon} ${c.label}</span>`;
          }).join('')}
          <span class="card-time">${formatDate(item.pubDate)} ${formatTime(item.pubDate)}</span>
        </div>
        <div class="card-title-row">
          <div class="card-title">${highlightKeywords(item.title, item.matchedKeywords)}</div>
          <span class="card-link-icon">‚Üó</span>
        </div>
        ${item.matchedKeywords.length > 0 ? `<div class="card-keywords">
          ${item.matchedKeywords.map(kw => `<span class="keyword-tag">${escapeHtml(kw)}</span>`).join('')}
        </div>` : ''}
      </div>
    </a>`;
  }).join('');
}

function renderCategoryChart() {
  const chart = document.getElementById('categoryChart');
  const allCats = [...CONFIG.CATEGORIES, { id: 'general', label: '„Åù„ÅÆ‰ªñ', color: '#6b7280' }];
  const maxCount = Math.max(...allCats.map(c => state.categoryCounts[c.id] || 0), 1);
  chart.innerHTML = allCats.map(cat => {
    const count = state.categoryCounts[cat.id] || 0;
    return `<div class="bar-row">
      <span class="bar-label">${cat.label}</span>
      <div class="bar-track"><div class="bar-fill" style="width:${(count/maxCount)*100}%;background:${cat.color};"></div></div>
      <span class="bar-count">${count}</span>
    </div>`;
  }).join('');
}

function renderSourceList() {
  document.getElementById('sourceList').innerHTML = CONFIG.FEEDS.map(feed => {
    const count = state.sourceCounts[feed.id] || 0;
    return `<div class="source-item">
      <span class="source-name">
        <span class="source-dot" style="background:${feed.color};"></span>
        ${feed.name}
      </span>
      <div style="display:flex;align-items:center;gap:8px;">
        <span class="source-count">${count}</span>
        <a class="source-link" href="${feed.homepage}" target="_blank" rel="noopener noreferrer">RSSÂÖÉ</a>
      </div>
    </div>`;
  }).join('');
}

function renderKeywordDisplay() {
  document.getElementById('keywordDisplay').innerHTML = CONFIG.CATEGORIES.map(cat => `
    <div class="keyword-group">
      <div class="keyword-group-title" style="color:${cat.color};">${cat.icon} ${cat.label}</div>
      <div class="keyword-pills">
        ${cat.keywords.slice(0, 10).map(kw => `<span class="keyword-pill" style="color:${cat.color};border-color:${cat.color}30;background:${cat.colorBg};">${kw}</span>`).join('')}
        ${cat.keywords.length > 10 ? `<span class="keyword-pill" style="color:var(--text-dim);border-color:var(--border-subtle);">+${cat.keywords.length - 10}</span>` : ''}
      </div>
    </div>
  `).join('');
}

function renderTicker() {
  const scroll = document.getElementById('tickerScroll');
  const latest = state.allItems.slice(0, 20);
  const html = latest.map(item => `
    <div class="ticker-item"><span class="ticker-item-source" style="background:${item.source.color}18;color:${item.source.color};">${item.source.shortName}</span>
    <span class="ticker-item-text">${escapeHtml(item.title)}</span></div><span class="ticker-dot">‚óè</span>
  `).join('');
  scroll.innerHTML = html + html;
  const dur = Math.max(latest.length * 4, 40);
  scroll.style.animationDuration = `${dur}s`;
}

function updateStats() {
  document.getElementById('stat-total').textContent = state.allItems.length;
  const matchedCount = state.allItems.filter(i => !i.categories.includes('general') || i.categories.length > 1).length;
  document.getElementById('stat-matched').textContent = matchedCount;
  document.getElementById('stat-sources').textContent = new Set(state.allItems.map(i => i.source.id)).size;
}

function computeCounts() {
  state.categoryCounts = {};
  state.sourceCounts = {};
  state.allItems.forEach(item => {
    item.categories.forEach(cat => { state.categoryCounts[cat] = (state.categoryCounts[cat] || 0) + 1; });
    state.sourceCounts[item.source.id] = (state.sourceCounts[item.source.id] || 0) + 1;
  });
}

function renderAll() {
  renderFilterBar();
  renderFeed();
  renderCategoryChart();
  renderSourceList();
  renderKeywordDisplay();
  renderTicker();
  updateStats();
}


// ================================================================
// FILTERS
// ================================================================
function toggleFilter(catId) {
  if (state.activeFilters.has(catId)) {
    if (state.activeFilters.size <= 1) return;
    state.activeFilters.delete(catId);
  } else {
    state.activeFilters.add(catId);
  }
  renderFilterBar();
  renderFeed();
}


// ================================================================
// CLOCK
// ================================================================
function updateClock() {
  const now = new Date();
  document.getElementById('clockTime').textContent = now.toLocaleTimeString('ja-JP', { hour:'2-digit', minute:'2-digit', second:'2-digit' });
  document.getElementById('clockDate').textContent = now.toLocaleDateString('ja-JP', { year:'numeric', month:'2-digit', day:'2-digit', weekday:'short' });
}


// ================================================================
// RSS FETCHER (LIVE MODE)
// ================================================================
async function fetchRSSFeeds() {
  if (CONFIG.DEMO_MODE) {
    state.allItems = generateDemoData();
    computeCounts();
    renderAll();
    hideLoading();
    return;
  }

  const allItems = [];
  state.fetchErrors = [];

  const promises = CONFIG.FEEDS.map(async feed => {
    try {
      const proxyUrl = CONFIG.CORS_PROXY + encodeURIComponent(feed.url);
      const resp = await fetch(proxyUrl, { signal: AbortSignal.timeout(15000) });
      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      const text = await resp.text();
      const xml = new DOMParser().parseFromString(text, 'text/xml');

      if (xml.querySelector('parsererror')) throw new Error('XML parse error');

      xml.querySelectorAll('item').forEach((item, idx) => {
        const title = (item.querySelector('title')?.textContent || '').trim();
        if (!title) return;
        const link = item.querySelector('link')?.textContent?.trim() || feed.homepage;
        const pubStr = item.querySelector('pubDate')?.textContent ||
                       item.querySelector('dc\\:date, date')?.textContent || '';
        const pubDate = pubStr ? new Date(pubStr) : new Date();

        allItems.push({
          id: `${feed.id}-${idx}`,
          title, link, source: feed, pubDate,
          categories: categorizeItem(title),
          matchedKeywords: findMatchedKeywords(title),
        });
      });
    } catch (err) {
      console.warn(`[${feed.shortName}] fetch failed:`, err.message);
      state.fetchErrors.push({ source: feed.shortName, error: err.message });
    }
  });

  await Promise.allSettled(promises);

  allItems.sort((a, b) => b.pubDate - a.pubDate);
  state.allItems = allItems.slice(0, CONFIG.MAX_ITEMS);
  computeCounts();
  renderAll();
  hideLoading();

  // Update mode indicator
  const mode = document.getElementById('dataMode');
  const label = document.getElementById('dataModeLabel');
  if (state.fetchErrors.length === 0) {
    mode.className = 'data-mode live';
    label.textContent = 'LIVE';
  } else if (state.allItems.length > 0) {
    mode.className = 'data-mode live';
    label.textContent = `LIVE (${state.fetchErrors.length} err)`;
  } else {
    mode.className = 'data-mode error';
    label.textContent = 'ERROR';
  }

  // Show error banner if needed
  const banner = document.getElementById('errorBanner');
  if (state.fetchErrors.length > 0 && state.allItems.length === 0) {
    banner.classList.add('visible');
    document.getElementById('errorText').innerHTML =
      `ÂÖ®„ÇΩ„Éº„Çπ„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇCORS„Éó„É≠„Ç≠„Ç∑„ÅÆË®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ ‚Üí <code>CONFIG.CORS_PROXY</code>`;
  } else {
    banner.classList.remove('visible');
  }
}


// ================================================================
// LOADING
// ================================================================
function hideLoading() {
  const overlay = document.getElementById('loadingOverlay');
  overlay.classList.add('hidden');
  setTimeout(() => overlay.remove(), 600);
}


// ================================================================
// INIT
// ================================================================
function init() {
  updateClock();
  setInterval(updateClock, 1000);
  fetchRSSFeeds();
  setInterval(fetchRSSFeeds, CONFIG.REFRESH_INTERVAL);
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
